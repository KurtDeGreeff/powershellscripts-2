Function Remove-EDGEPowerShellTools
{
  [Cmdletbinding()]
  param
  ( 
    [switch]$CleanupExisting
  )
  
  Begin
  {
    Write-Verbose -Message "Starting $($MyInvocation.Mycommand)"
  }
  Process
  {
  
    if($CleanupExisting.isPresent) 
    {
      Write-Verbose -Message 'Cleaning Up Existing EDGE.PowerShell.Tools'
      Try
      {
        if(Test-Path -Path 'C:\Scripts') 
        {
          Remove-Item -Path 'C:\Scripts\' -Recurse -Force -ErrorAction SilentlyContinue
        }
				  
        if(Test-Path -Path "$env:windir\System32\WindowsPowerShell\v1.0\profile.ps1") 
        {
          Remove-Item -Path "$env:windir\System32\WindowsPowerShell\v1.0\profile.ps1" -Force -ErrorAction SilentlyContinue
        } 
      }
      Catch
      {
        Write-Warning -Object "Error was $_"
        $line = $_.InvocationInfo.ScriptLineNumber
        Write-Warning -Object "Error was in Line $line"
        break
      }
        
      Remove-FolderEnvPath -Path 'C:\Scripts\Tools' -Type EnvPath
      Remove-FolderEnvPath -Path 'C:\Tools\Tools'  -Type EnvPath
      Remove-FolderEnvPath -Path 'C:\Scripts\Modules'  -Type EnvPSModulePath
    }
    else 
    {
      Write-Verbose -Message 'Uninstalling EDGE.PowerShell.Tools'

      Try
      {
        if(Test-Path -Path 'C:\Tools') 
        {
          Remove-Item -Path 'C:\Tools' -Recurse -Force -ErrorAction SilentlyContinue
        }
				  
        if(Test-Path -Path "$env:windir\System32\WindowsPowerShell\v1.0\profile.ps1") 
        {
          Remove-Item -Path "$env:windir\System32\WindowsPowerShell\v1.0\profile.ps1" -Force -ErrorAction SilentlyContinue
        } 

		if(Test-Path -Path "$env:UserProfile\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1")
		{
		   Remove-Item -Path "$env:UserProfile\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Force -ErrorAction SilentlyContinue
		}
      }
      Catch
      {
        Write-Warning -Object "Error was $_"
        $line = $_.InvocationInfo.ScriptLineNumber
        Write-Warning -Object "Error was in Line $line"
        break
      }

      Remove-FolderEnvPath -Path 'C:\Tools\Utilities' -Type EnvPath
      Remove-FolderEnvPath -Path 'C:\Tools\Modules'  -Type EnvPSModulePath
      
      
      Try 
      {
        [Environment]::SetEnvironmentVariable('NuGetServer',$null,'Machine')
      }      
      Catch
      {
        Write-Warning -Object "Unable to remove NuGetServer environment variable"
      }
      
      Try 
      {
        [Environment]::SetEnvironmentVariable('ScriptsDir',$null,'Machine')
      }      
      Catch
      {
        Write-Warning -Object "Unable to remove ScriptsDir environment variable"
      }

      Try 
      {
        [Environment]::SetEnvironmentVariable('Server',$null,'Machine')
      }      
      Catch
      {
        Write-Warning -Object "Unable to remove Server environment variable"
      }

      Try 
      {
        [Environment]::SetEnvironmentVariable('SitesXML',$null,'Machine')
      }      
      Catch
      {
        Write-Warning -Object "Unable to remove SitesXML environment variable"
      }

      Try 
      {
        [Environment]::SetEnvironmentVariable('SourcesDir',$null,'Machine')
      }      
      Catch
      {
        Write-Warning -Object "Unable to remove SourcesDir environment variable"
      }
    }
  }
  End 
  {
    Write-Verbose -Message "Ending $($MyInvocation.Mycommand)"
  }
}
Remove-EDGEPowerShellTools
